<% counter = 0 %>
<% Dashboard.fetch_projects.each do |project| %>
  <div class="container ms-5">
    <div class="row">
      <div class="d-flex justify-content-center margin-5 ms-5">
        <div class="col-sm-1 col-md-6 col-lg-7">
          <%counter += 1 %>
          <div class="card mt-4 dashboard-card-border collapse multi-collapse" id="multiCollapseExample<%= counter %>">
            <div class="card-body">
              <h6 class="card-title"><%= t('projects.project_label') + ' ' + counter.to_s %></h6>
              <% total_logged_time = Dashboard.issues_logged_time(project) %>
              <% estimated_time = Dashboard.issues_estimated_time(project) %>
              <% if total_logged_time.present? and estimated_time.present? %>
              <% value = Issue.time_progression(total_logged_time,estimated_time) %>
              <div class="progress w-100">
                <div class="progress-bar" role="progressbar" style="width: <%= value %>%;" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><%= value.round(2).to_s + '%' %></div>
                <% if total_logged_time > estimated_time%>
                <div class="progress-bar bg-danger" role="progressbar" style="width: <%= 100- value %>%" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100"><%= (100- value).round(2).to_s + '%' %></div>
                <% end %>
              </div>
              <% end %>
              <% if Dashboard.fetch_project_issues(project).present? %>
                <%= line_chart [
                { name: t('shared.est_end_date'), data: Dashboard.fetch_project_issues(project).group(:estimated_end_date).count },
                { name: t('shared.end_date'), data: Dashboard.fetch_project_issues(project).group(:actual_end_date).count }
                ], xtitle: "Time", ytitle: "Population" %>
              <% end %>
            </div>
          </div>
        </div>
        <% if Dashboard.fetch_sprint_issues(project).present? %>
          <div class="col-sm-1 col-md-3 ms-4 pe-2">
            <div class="card mt-4 dashboard-card-border collapse multi-collapse" id="multiCollapseExample<%= counter %>">
              <div class="card-body">
                <h6 class="card-title ms-2"><%= t('shared.total') + ' ' + t('issues.issues_label') %></h6>
                <div class="text-7xl orange"><%= Dashboard.fetch_sprint_issues(project).count %></div>
                <div class="d-flex justify-content-center">
                <div class="text-md me-1"><%= t('shared.closed') + ':'%></div>
                  <h6><%= Dashboard.fetch_sprint_issues(project).where(status: "CLOSED").count %></h6>
              </div>
            </div>
          </div>

          <div class="card mt-2 dashboard-card-border collapse multi-collapse" id="multiCollapseExample<%= counter %>">
            <div class="card-body">
              <h6 class="card-title ms-2"><%= t('shared.in_progress') + ' ' + t('issues.issues_label') %></h6>
              <div class="text-7xl tomato"><%= Dashboard.fetch_sprint_issues(project).where(status: "In Progress").count %></div>
              <div class="d-flex justify-content-center">
                <div class="text-md me-1"><%= t('issues.high') + ' ' + t('issues.priority') + ':'%></div>
                <h6><%= Dashboard.fetch_sprint_issues(project).where(status: "In Progress").where(priority: "High").count %></h6>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
<% end %>  